<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">
  
  <title>菜单导航</title>

    <link rel="stylesheet" href="css/style.css" media="screen" type="text/css" />
    <link href="css/common.css" type="text/css" rel="stylesheet"/>
    <link href="css/index.css" type="text/css" rel="stylesheet"/>
	
    <script src="javascript/jquery.min.js"></script>
    <script src="javascript/three.js"></script>
    <script src="javascript/SceneLoader.js"></script>
    <script src="javascript/SceneExporter.js"></script>
    <script src="javascript/flexible.js"></script>
    <script src="javascript/OrbitControls.js"></script>

    <script src="imagejs/utilitie.js" type="text/javascript" charset="utf-8"></script>
    <script src="imagejs/canvasEl.js" type="text/javascript" charset="utf-8"></script>
    <script src="imagejs/canvasIm.js" type="text/javascript" charset="utf-8"></script>

    <script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>

    <style>
        body {
            margin: 0;
        }

        canvas {
            border: 1px;
            top: 0;
            left: 0;
            position: absolute;
            width:100%;
            height: 100%;
        }

        img {
            display: none;
            position: absolute;
        }

    </style>
</head>

<body>
<!-- <header class="aui-bar aui-bar-nav aui-bar-warning" id="aui-header">
        	<a class="aui-pull-left" tapmode onclick="api.closeWin();"> <span class="aui-iconfont aui-icon-left"></span>返回 </a>
        <div class="aui-title">DIY</div>
        <a class="aui-pull-right" tapmode onclick="openFrame('share_body', '../share_body')"> <span class="aui-iconfont aui-icon-cart"></span></a>       
    </header>-->
    <div id="content"></div>
    <canvas id="canvid1"></canvas>
    <img id = "img1" src="" width="200" height="200">
    <div class='all'>
        <div class='box'>
            <div class='card bg-00'>
                <span class='card-content'>
                    选择模式 ：<select type="text" id = "model">
                    <option>-选择模型-</option>
                    <option>衣服模型</option>
                    <option>手机模型</option>
                </select>
                    <button onclick="">选择</button>
                </span>

            </div>
        </div>
        <div class='box'>
            <div class='card bg-06'>
                <span class='card-content'>
                    <button onclick="editor()">diy</button>
                    <button onclick="move()">预览</button>
                    <button onclick="save()">保存</button>
                    <button onclick="load()">加载</button>
                </span>
            </div>
        </div>
        <div class='box'>
            <div class='card bg-01'>
                <span class='card-content'>
                    文字内容 ：<input type="text" name="word" />
                </span>
            </div>
        </div>
        <div class='box'>
            <div class='card bg-02'>
                <span class='card-content'>
                    文字字体 ：<select type="text" name="font">
                        <option>-选择文字字体-</option>
                        <option>Arial</option>
                        <option>normal</option>
                        <option>oblique</option>
                        <option>italic</option>
                    </select>
                </span>
            </div>
        </div>
        <div class='box'>
            <div class='card bg-03'>
                <span class='card-content'>
                    文字大小 ：<select type="text" name="size">
                                <option>-选择文字大小-</option>
                                <option>100</option>
                                <option>150</option>
                                <option>200</option>
                                <option>250</option>
                                <option>300</option>
                    </select>
                    <button onclick="">添加文字</button>
                    <button onclick="">清空</button>
                </span>
            </div>
        </div>
        <div class='box'>
            <div class='card bg-04'>
                <span class='card-content'>
                    <div>
                        <input type="file" id="imgFile">
                    </div>
                </span>
            </div>
        </div>
        <!-- <div class='box'>
            <div class='card bg-05'>
                <span class='card-content'>
                    <button onclick="a()">添加文字</button>
                    <button onclick="clearCanvas()">清空</button>
                </span>
            </div>
        </div> -->
        
        <div class='box'>
            <!--<div style="width: 300px;height: 300px;position: absolute;">-->
                <!--<img id="demoImg" style="height: 100px;width: 100px" alt="">-->
                <!--&lt;!&ndash;<div style="width: 50px;height: 50px;border: 1px solid #4fb8e3;position: absolute;left: 0;top: 0;z-index: 1000" id="chooseBox"></div>&ndash;&gt;-->
            <!--</div>-->
            <!--<div id="preview">-->
                <!--<img src="images/photo_icon.png" width="178" height="178" onclick="$('#previewImg').click()">-->
                <!--<input type="file" onchange="previewImage(this)" style="display: none;" id="previewImg">-->
            <!--</div>-->
        </div>

            <!--<div class="img-box full">-->
                <!--<section class=" img-section">-->
                    <!--<div class="z_photo upimg-div clear" >-->
                        <!--<section class="z_file fl">-->
                            <!--<img src="images/a11.png" class="add-img">-->
                            <!--<input type="file" name="file" id="file" class="file" value="" accept="image/jpg,image/jpeg,image/png,image/bmp" multiple />-->
                        <!--</section>-->
                    <!--</div>-->
                <!--</section>-->
            <!--</div>-->
            <!--<aside class="mask works-mask">-->
                <!--<div class="mask-content">-->
                    <!--<p class="del-p">您确定要删除作品图片吗？</p>-->
                    <!--<p class="check-p"><span class="del-com wsdel-ok">确定</span><span class="wsdel-no">取消</span></p>-->
                <!--</div>-->
            <!--</aside>-->

    </div>
    <script src="javascript/flexible.js"></script>
    <script src="js/font.js"></script>
    <!--<script src="js/clothes.js"></script>-->
    <!--<script src="js/choose.js"></script>-->
    <script src="js/hammer.js"></script>
    <script src="js/Scence.js"></script>  
    <script type="text/javascript" src="./script/api.js"></script>
	<script type="text/javascript" src="./script/common.js"></script>
	<script type="text/javascript" src="./script/zepto.min.js"></script>
    <script>
    alert("int diy");
    apiready = function(){
    var img1=document.getElementById("img1");
    alert("asdf++" +JSON.stringify(api.pageParam.url0.changjingxinxi));
    localStorage.setItem('pageParam', api.pageParam.url0);
    img1.src=api.pageParam.url0.img;
    load(api.pageParam.url0.changjingxinxi,api.pageParam.url0.img);
//		api.parseTapmode();
//		url0 = api.pageParam.url0;
}
        var el = document.querySelector("#canvid1");
        var hammertime = new Hammer(el);
        hammertime.get('pinch').set({ enable: true });
        hammertime.get('rotate').set({ enable: true });
        isrotate = '';
        var CanvasDemo = function() {
            var YD = YAHOO.util.Dom;
            var canvas1;
            var img = [];
            return {
                init: function() {
                    canvas1 = new Canvas.Element();
                    canvas1.init('canvid1',  { width: YD.getViewportWidth() - 5, height: YD.getViewportHeight() - 5 });
                    img[img.length] = new Canvas.Img('img1', {});
                    canvas1.addImage(img[0]);
                }
            }
        }();
        YAHOO.util.Event.on(window, 'load', CanvasDemo.init, CanvasDemo, true);



        $('#imgFile').change(function () {
            var file=$('#imgFile')[0].files[0];
            var reader=new FileReader();
            reader.onload= function (e) {
                $('#img1').attr('src', e.target.result);
            };
            reader.readAsDataURL(file);
            changeImage();
        });

        function changeImage() {
            var el = document.querySelector("#canvid1");
            var hammertime = new Hammer(el);
            hammertime.get('pinch').set({ enable: true });
            hammertime.get('rotate').set({ enable: true });
            var CanvasDemo = function() {
                var YD = YAHOO.util.Dom;
                var canvas1;
                var img = [];
                return {
                    init: function() {
                        canvas1 = new Canvas.Element();
                        canvas1.init('canvid1',  { width: YD.getViewportWidth() - 5, height: YD.getViewportHeight() - 5 });
                        img[img.length] = new Canvas.Img('img1', {});
                        canvas1.addImage(img[0]);
                    }
                }
            }();
            YAHOO.util.Event.on(window, 'load', CanvasDemo.init, CanvasDemo, true);
        }

        function convertCanvasToImage(canvas) {
            //新Image对象，可以理解为DOM
            var image = new Image();
            // canvas.toDataURL 返回的是一串Base64编码的URL，当然,浏览器自己肯定支持
            // 指定格式 PNG
            image.src = canvas.toDataURL("image/png");
            return image;
        }

        function move() {
            isdrag = true;
            isTouch = true;
            document.getElementById("canvid1").style.display = "none";
        }
        function editor() {
            isdrag = false;
            isTouch = false;
            document.getElementById("canvid1").style.display = "block";
        }

        function download() {
            var type = 'png';
            var imgdata = canvas.toDataURL(type);
            //将mime-type改为image/octet-stream,强制让浏览器下载
            var fixtype = function (type) {
                type = type.toLocaleLowerCase().replace(/jpg/i, 'jpeg');
                var r = type.match(/png|jpeg|bmp|gif/)[0];
                return 'image/' + r;
            };
            imgdata = imgdata.replace(fixtype(type), 'image/octet-stream');
            //将图片保存到本地
            var saveFile = function (data, filename) {
                var link = document.createElement('a');
                link.href = data;
                link.download = filename;
                var event = document.createEvent('MouseEvents');
                event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                link.dispatchEvent(event);
            };
            var filename = 'a.' + type;
            
            saveFile(imgdata, filename);
            return imgdata;
        }
    </script>

</body>
</html>
